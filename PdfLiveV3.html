<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF live</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *{
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        html, body {
            height: 100%;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            height: 100vh; /* Ensure body takes full viewport height */
        }
        .container {
            display: flex;
            height: 100vh;
        }
        aside {
            width: 300px; /* Slightly reduced width for sidebar */
            background: #282828;
            color: white;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            box-sizing: border-box;
            border-right: 1px solid #3a3a3a;
            flex-shrink: 0; /* Prevent shrinking on smaller screens */
        }
        .toolbar {
            display: flex;
            flex-direction: column;
            gap: 15px;
            color: #e0e0e0;
            align-items: flex-start;
            border-bottom: 1px solid #3a3a3a;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .toolbar > div {
            width: 100%; 
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #bbbbbb;
        }
        input[type="file"] {
            font-size: 12px;
            background-color: #3a3a3a;
            color: white;
            border: 1px solid #555;
            padding: 8px;
            border-radius: 5px;
            width: 100%; 
            box-sizing: border-box;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        input[type="file"]:hover {
            background-color: #4a4a4a;
            border-color: #777;
        }
        audio {
            width: 100%;
            height: 40px;
            border-radius: 5px;
            background: #3a3a3a;
        }
        .playlist {
            flex: 1;
            overflow-y: auto;
            max-height: 200px; 
            background: #3a3a3a;
            padding: 8px;
            border-radius: 5px;
            font-size: 13px;
            border: 1px solid #444;
            min-height: 80px; 
        }
        .playlist div {
            cursor: pointer;
            padding: 8px 5px;
            border-bottom: 1px solid #444;
            transition: background 0.2s, color 0.2s;
        }
        .playlist div:last-child {
            border-bottom: none;
        }
        .playlist div:hover {
            background: #4a4a4a;
            border-radius: 3px;
        }
        .playlist .active-audio {
            background: #ffb14c; 
            color: white;
            font-weight: bold;
            border-radius: 3px;
        }
        .search-container {
            display: flex;
            gap: 5px;
            width: 100%;
        }
        #search-input {
            flex: 1;
            background: #3a3a3a;
            border: 1px solid #555;
            color: white;
            padding: 8px;
            border-radius: 5px;
            outline: none;
            font-size: 13px;
        }
        #search-input:focus {
            border-color: #ffb14c;
        }
        .search-container button {
            background: #3a3a3a;
            border: 1px solid #555;
            color: #bbbbbb;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, color 0.2s;
        }
        .search-container button:hover {
            background-color: #4a4a4a;
            color: white;
        }
        .main-content {
            flex: 1; /* Use flex: 1 to allow it to grow and shrink */
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #f0f2f5; /* Light background for the PDF viewer area */
        }
        #pdf-viewer {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            flex: 1;
        }
        /* Basic Responsiveness for PC/Laptop */
        @media (max-width: 1200px) {
            aside {
                width: 300px; /* Slightly smaller sidebar on medium screens */
            }
        }
        @media (max-width: 992px) {
            .container {
                flex-direction: column; /* Stack sidebar and main content vertically */
            }
            aside {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #3a3a3a;
                height: auto; 
            }
            .toolbar {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-around;
                border-bottom: none;
            }
            .toolbar > div {
                width: 48%;
            }
            audio {
                width: 98%;
            }
            .playlist {
                max-height: 150px;
            }
            .main-content {
                height: 70vh; 
            }
        }
        @media (max-width: 768px) {
            .toolbar > div {
                width: 95%;
            }
            audio {
                width: 95%;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <aside>
            <div class="toolbar">
                <div>
                    <label>1. Chọn PDF: </label><br>
                    <input type="file" id="pdf-input" accept="application/pdf">
                </div>
                <div>
                    <label>2. Chọn nhiều Audio: </label><br>
                    <input type="file" id="audio-input" accept="audio/*" multiple>
                </div>
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Tìm kiếm audio...">
                    <button id="clear-btn" title="Làm sạch">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="playlist" id="playlist">Danh sách âm thanh đang trống!</div>
                <audio id="audio-player" controls></audio>
            </div>
        </aside>
        <div class="main-content">
            <iframe id="pdf-viewer" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        const pdfInput = document.getElementById('pdf-input');
        const audioInput = document.getElementById('audio-input');
        const pdfViewer = document.getElementById('pdf-viewer');
        const audioPlayer = document.getElementById('audio-player');
        const playlistDiv = document.getElementById('playlist');
        const searchInput = document.getElementById('search-input');
        const clearBtn = document.getElementById('clear-btn');

        // Xử lý chọn PDF
        pdfInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) pdfViewer.src = URL.createObjectURL(file);
        };

        // Xử lý danh sách Audio
        let audioFiles = [];
        let currentAudioIndex = -1;

        function renderPlaylist(filterText = "") {
            playlistDiv.innerHTML = "";
            const filteredFiles = audioFiles.map((file, index) => ({ file, index }))
                .filter(item => item.file.name.toLowerCase().includes(filterText.toLowerCase()));

            if (filteredFiles.length === 0) {
                playlistDiv.innerHTML = audioFiles.length === 0 ? "Danh sách âm thanh đang trống!" : "Không tìm thấy kết quả!";
                return;
            }else {
                playlistDiv.innerHTML = "Có " + filteredFiles.length + " file(s)";
            }

            filteredFiles.forEach((item) => {
                const div = document.createElement('div');
                div.innerText = `${item.index + 1}. ${item.file.name}`;
                div.dataset.index = item.index;
                if (item.index === currentAudioIndex) {
                    div.classList.add('active-audio');
                }
                div.onclick = () => {
                    setActiveAudio(item.index);
                    audioPlayer.src = URL.createObjectURL(item.file);
                    audioPlayer.play();
                };
                playlistDiv.appendChild(div);
            });
        }

        audioInput.onchange = (e) => {
            audioFiles = Array.from(e.target.files);
            currentAudioIndex = -1;
            renderPlaylist(searchInput.value);
        };

        searchInput.oninput = () => {
            renderPlaylist(searchInput.value);
        };

        clearBtn.onclick = () => {
            searchInput.value = "";
            renderPlaylist("");
        };

        function setActiveAudio(index) {
            currentAudioIndex = index;
            const items = playlistDiv.querySelectorAll('div');
            items.forEach((el) => {
                if (parseInt(el.dataset.index) === index) {
                    el.classList.add('active-audio');
                } else {
                    el.classList.remove('active-audio');
                }
            });
        }

        // Khi audio bắt đầu phát (cả khi bấm play thủ công)
        audioPlayer.addEventListener('play', () => {
            if (!audioFiles.length) return;
            const currentSrc = audioPlayer.src;
            // Decode URI to match file name correctly
            const decodedSrc = decodeURIComponent(currentSrc);
            const idx = audioFiles.findIndex(f => decodedSrc.endsWith(f.name));
            if (idx !== -1) setActiveAudio(idx);
        });
    </script>

</body>

</html>